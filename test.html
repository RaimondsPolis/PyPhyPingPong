<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <title>Physics pong</title>
    <style>
        body {
            margin: 0; /* Remove default margin */
            overflow: hidden; /* Prevent scrolling */
        }
    </style>
</head>

<!---------------------------------------------------------------------------------------------------------------------------------------------------------------->

<body>

    <canvas id=myCanvas width=1500 height= 800 style="background-color: rgb(66, 41, 45)"> </canvas>
    <script>
        function resizeCanvas() {
            myCanvas.width = window.innerWidth;
            myCanvas.height = window.innerHeight;
        }

        // Resize canvas on load and when window resizes
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        //viss kods būs šeit
    
        //vajag: Gravitācija, enerģijas nezūdamības likums, paātrinājums, koordinātes vienādojums, ROTĒJOŠS PAMATS
  

    //i have no idea what im doing
    var ctx = myCanvas.getContext("2d");
/*
    // Draw a fill rectange, starting top left x and y, for a width and height
    ctx.fillRect(100, 100, 20, 10);
    ctx.fillStyle= "red";
    ctx.fillRect(90, 90, 10, 50);
    ctx.fillStyle= "white";
    ctx.fillRect(80, 80, 50, 10)

   
    ctx.lineWidth=4;//thickness of the line
    ctx.strokeStyle= "red"; //color of the line
    ctx.strokeRect(50, 50, 20, 40); //draws the outline of the shape

    //-------------
    ctx.fillStyle= "green";
    ctx.strokeStyle= "red";
    ctx.lineWidth= 4;        //the following draws a green rectangle with a red outline

    ctx.fillRect(200, 50, 70, 90);
    ctx.strokeRect(200, 50, 70, 90);
    //--------------
    ctx.fillStyle="yellow";//šis pats strādā tekstam
    ctx.strokeStyle="black";//šis pats strādā tekstam
    ctx.lineWidth = 2; //šis pats strādā arī teksta outlineam
    ctx.font= "60px Arial"; // FONT AND SIZE of the text
    ctx.fillText("Hello", 10, 50); // TEXT CONTENT AND X, Y POSITION
    ctx.strokeText("Goodbye", 10, 110);// TEXT CONENT OUTLINE AND X, Y POSITION
    //--------------
    ctx.beginPath();                         // Start drawing something
    ctx.arc(150, 150, 100, 0, Math.PI*2);   // Make it a circle (X, Y, NO KURIEnes, LĪDZ KURIENEI (!!!RADIĀNOS!!!))
    ctx.stroke();                            // Outline an outline
    //--------------
    //RECTANGLES ARE POSITIONED ON THE TOP LEFT OF THEIR GIVEN COORDINATE
    //CIRCLES ARE POSITIONED ON THE CENTER OF THE GIVEN COORDINATE
    //--------------
    ctx.beginPath();
    ctx.arc(200, 200, 25, 0, Math.PI * 2);
    ctx.fillStyle= "green";
    ctx.fill(); // lai iekrāsotu apli
    //--------------
    function fillCircle (x, y, radius, colour) {
        ctx.beginPath();
        ctx.fillStyle= colour;
        ctx.arc(x, y, radius, 0, Math.PI * 2);// advanced FILL CIRCLE f(x)
        ctx.fill();
    }
    //-----------------
        var corner= 0;
        var size = 0;
        while (corner < 500) {
            ctx.strokeRect(corner, corner, size, size);//WHILE LOOP PIEMĒRS
            corner= corner + 5;
            size +=10;
        }
        ctx.fillRect(corner, corner, 50, 50);
    //-------------
    for (var corner= 0; corner < 100; corner= corner+1) { //FOR LOOP PIEMĒRS
        ctx.strokeRect(corner, corner, 50, 50);
    }
    //-------------
    var thing = Math.random(); //returno random skaitli no 0(ieskaitot) līdz 1(neieskaitot)
    //-------------
    var thing = Math.floor(Math.random() * 20); // returno random INTIGER(veselu skaitli) no 1 - 19 ieskaitot
    //---------------
    function RandInt(up_to) { 
        n = Math.floor(Math.random() * up_to);  //returno random intiger līdz dortajam skaitlim
        return(n);  
   } 

   fillCircle(RandInt(myCanvas.width), RandInt(myCanvas.height), RandInt(30), "red"); // draw circle in random place with random size
   // myCanvas.height ir no canvas id 16. rindiņā (id="myCanvas")un height/ width vnk izvēlas kuru parametru mainīs
   //--------------
   function CircleRandColour (x, y, radius) {
  r = RandInt(3);   // r will be 0, 1 or 2
  if (r == 0) {
             ctx.fillStyle = "red";
             }
  else if (r == 1) {
             ctx.fillStyle= "green"; // RANDOM COLOR 
             }
  else if (r == 2) {
             ctx.fillStyle= "blue";
             }
    }
    //-------------

    var y_pos = 0;

    function MyTimer () {
        //ctx.clearRect(0, 0, myCanvas.width, myCanvas.height); //CLEAR/GET RID OF ALL SHAPES
        y_pos = y_pos + 4;
        ctx.strokeRect(120, y_pos, 60, 60);//MAKING SPRITES MOVE N SHIT
    }

    setInterval(MyTimer, 500);//TIME DELAY
*/
    //-----------------
    /*
    KUSTĪBAS PROTOTIPS ---- SCRAPPED 


    var y_pos = 300;
    var x_pos = 300;
    var new_x = 50;
    var new_y = 50;
    var angle =0;
    ctx.strokeStyle= "red";
    ctx.lineWidth= 2;
    //ctx.clearRect(0, 0, myCanvas.width, myCanvas.height);
    function MyTimer1 (MyEvent) {

        ctx.clearRect(x_pos-1, y_pos-1, 52 ,52);//falling object ish
            if (MyEvent.keyCode == 39) {x_pos = x_pos + 10;}   // right
            if (MyEvent.keyCode == 40) {y_pos = y_pos + 10;}   // down
            if (MyEvent.keyCode == 37) {x_pos = x_pos - 10;} 
            if (MyEvent.keyCode == 38) {y_pos = y_pos - 10;} 
            if (MyEvent.keyCode == 38) {
               ctx.rotate(angle)//????????????????????????????????????
               angle +=10;
            }
        ctx.strokeRect(x_pos, y_pos, 50, 50);
    }


    window.addEventListener("keydown", MyTimer1);

*/  
var rotationSpeed = 0; // Rotation speed (radians per frame)
var horizontalSpeed = 0; // Horizontal speed of the platform
function fillCircle (x, y, radius, colour) {
        ctx.beginPath();
        ctx.fillStyle= colour;
        ctx.arc(x, y, radius, 0, Math.PI * 2);// advanced FILL CIRCLE f(x)
        ctx.fill();
    };

//-------------------------------------
// Collision detection between a rectangle and a circle
function rotatePoint(px, py, cx, cy, angle) {
    const dx = px - cx;
    const dy = py - cy;
    const cos = Math.cos(-angle);
    const sin = Math.sin(-angle);
    return {
        x: dx * cos - dy * sin + cx,
        y: dx * sin + dy * cos + cy
    };
}

function clamp(val, min, max) {
    return Math.max(min, Math.min(max, val));
}

function rectCircleCollision(rect, circle) {
    const local = rotatePoint(circle.x, circle.y, rect.x, rect.y, rect.angle);
    const hw = rect.width / 2;
    const hh = rect.height / 2;

    const closestX = clamp(local.x, rect.x - hw, rect.x + hw);
    const closestY = clamp(local.y, rect.y - hh, rect.y + hh);

    const dx = local.x - closestX;
    const dy = local.y - closestY;

    return (dx * dx + dy * dy) <= (circle.radius * circle.radius);
}

//-------------------------------------


// ...existing code...

function bounceOffPlatform(ball, platformAngle, bounce = 1) {
    const velocity = { x: ball.vx, y: ball.vy };

    // Calculate the normal vector of the platform
    const normal = {
        x: Math.sin(platformAngle),
        y: -Math.cos(platformAngle)
    };

    // Calculate the dot product of the velocity and the normal
    const dot = velocity.x * normal.x + velocity.y * normal.y;

    // Reflect the velocity vector
    const reflected = {
        x: velocity.x - 2 * dot * normal.x,
        y: velocity.y - 2 * dot * normal.y
    };

    // Apply the bounce factor
    ball.vx = reflected.x * bounce;
    ball.vy = reflected.y * bounce;
}

function acceleration() {
    console.log("ir!");
    ctx.clearRect(0, 0, myCanvas.width, myCanvas.height);

    // Update ball position
    ball.x += ball.vx;
    ball.y += ball.vy;
    ball.vy += speedChange; // Gravity effect

    fillCircle(ball.x, ball.y, ball.radius, "white"); // Draw ball

    // Update platform position
    x += horizontalSpeed;

    // Platform properties
    const platform = {
        x: x,
        y: y,
        width: platform_width,
        height: platfrom_height,
        angle: rotationAngle
    };

    // Check for collision
    if (rectCircleCollision(platform, ball)) {
        console.log("Collision detected!");
        bounceOffPlatform(ball, platform.angle, 1); // Adjust ball velocity based on platform angle
    }

    // Draw rotated platform
    ctx.save();
    ctx.translate(x, y);
    rotationAngle += rotationSpeed;
    ctx.rotate(rotationAngle);
    ctx.fillStyle = "white";
    ctx.fillRect(-platform_width / 2, -platfrom_height / 2, platform_width, platfrom_height);
    ctx.restore();

    // Ball bounce logic for screen edges
    if (ball.y + ball.radius > myCanvas.height || ball.y - ball.radius < 0) {
        ball.vy = -ball.vy; // Reverse vertical velocity
    }
    if (ball.x + ball.radius > myCanvas.width || ball.x - ball.radius < 0) {
        ball.vx = -ball.vx; // Reverse horizontal velocity
    }
}

setInterval(acceleration, 1);

// Ball properties
const ball = {
    x: 950,
    y: 100,
    vx: 0, // Initial horizontal velocity
    vy: 0, // Initial vertical velocity
    radius: 30
};

// Platform properties
var rotationAngle = 0;
var rotationSpeed = 0;
var horizontalSpeed = 0;
var platfrom_height = 25;
var platform_width = 250;
var x = 950;
var y = 850;
var speedChange = 0.03;

// Event listeners for platform movement
function MovePlatform(action) {
    if (action.keyCode == 39) {
        horizontalSpeed = 2; // Move right
    }
    if (action.keyCode == 37) {
        horizontalSpeed = -2; // Move left
    }
    if (action.keyCode == 40) {
        rotationSpeed = Math.PI / 360; // Rotate clockwise
    }
    if (action.keyCode == 38) {
        rotationSpeed = -Math.PI / 360; // Rotate counter-clockwise
    }
}

function StopRotation(action) {
    if (action.keyCode == 39 || action.keyCode == 37) {
        horizontalSpeed = 0; // Stop horizontal movement
    }
    if (action.keyCode == 38 || action.keyCode == 40) {
        rotationSpeed = 0; // Stop rotation
    }
}

window.addEventListener("keydown", MovePlatform);
window.addEventListener("keyup", StopRotation);
    </script>


<!---------------------------------------------------------------------------------------------------------------------------------------------------------------->
</body>

</html>